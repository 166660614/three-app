<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
		<script src="js/app.js"></script> 
		<link href="css/mui.min.css" rel="stylesheet"/>
		<link href="css/app.css" rel="stylesheet"/>
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<script src="js/mui.min.js"></script>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">商品详情页</h1>
		</header>
		<br/><br/></br>
	<div id="show">
		<div>
			<h3>商品名称</h3><label></label>
			<h3>商品价格</h3><span></span>
			<h3>商品库存</h3><span></span>
			<h3>购买数量</h3><input type="text"  value="1">
			<button class="btn btn-success btn-block">点击加入购物车</button>
			<button class="btn btn-success btn-block">加入收藏</button>
		</div>
	</div>
	</body>
	<script type="text/javascript">
		$(function(){
			var goods_id=localStorage.getItem('goods_id');
			$.ajax({
				url: 'http://three.52self.cn/goods/details',
				type:'post',
				data :{goods_id:goods_id},
				dataType:'json',
			    success:function (result) {
							var _h3='';
							_h3+="<div goods_id="+result.msg.goods_id+">"
							+"<h3>商品名称</h3><label class='goods_name'>"+result.msg.goods_name+"</label>"
							+"<h3>商品价格</h3><span class='goods_price'>"+result.msg.goods_price+"</span>"
							+"<h3>商品库存</h3><span class='goods_store'>"+result.msg.goods_store+"</span>"
							+"<h3>购买数量</h3><input type='text'  value='1' class='goods_num'>"
							+"<button class='addcart btn btn-success btn-block'>点击加入购物车</button>"
							+"<button class='addput btn btn-success btn-block'>加入收藏</button>"
							+"<button class='dot btn btn-large'><i class='icon-star'>点赞</i><span>0</span></button>"
							+"</div>";
							if(result.error==0){
								$("#show").html(_h3)
							}else{
								alert('非法操作')
							}
							
				   },
			})
			$(document).on('click','.addcart',function(){
				var _this=$('this')
				var goods_name=$('.goods_name').text();
				//alert(goods_name)
				var goods_price=$('.goods_price').text();
				var goods_store=$('.goods_store').text();
				var goods_num=$('.goods_num').text();
				$.ajax({
					url     :   'http://three.52self.cn/cart/join',
					type    :   'post',
					dataType:   'json',
					data    :  {goods_name:goods_name,goods_price:goods_price,goods_store:goods_store,goods_num:goods_num},
					 success :   function(res){
						 if(res.errcode==0){
							 alert('已加入购物车')
						 }else{
							 alert('res.msg')
						 }
				})
			})
		})
		$(document).on('click','.addput',function(){
				var _this=$('this')
				var timestamps = (new Date()).getTime();
				//console.log(timestamps); 
				var user_id=localStorage.getItem('user_id');
				//console.log(user_id);
				$.ajax({
					url     :   'http://three.52self.cn/collect/add',
					type    :   'post',
					dataType:   'json',
					data    :  {timestamps:timestamps,user_id:user_id},
					 success :   function(res){
						 //console.log(res.errcode);
						 if(res.errcode==4001){
						 	alert('收藏成功')
						 }else{
						 	alert('你已经收藏过了')
						 }
						 }
				})
			})
			$(document).on('click','.dot',function(){
					var _this=$(this);
					var timestamps = (new Date()).getTime();
					var user_id=localStorage.getItem('user_id');
					var goods_id=_this.parents('tr').attr('goods_id');	
					$.ajax({
						url     :   'http://three.52self.cn/user/dot',
						type    :   'post',
						dataType:   'json',
						data    :  {timestamps:timestamps,user_id:user_id,goods_id:goods_id},
						success :   function(res){
							if(res.errcode==0){
									alert('点赞成功')
							}else{
									alert('你已经点过了')
							}
						})
					})
	</script>
</html>
